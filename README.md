# Semantic Analysis

## Symbol Table

符号表的设计主要考虑两个方面的问题：

1. 变量作用域(scope)：由于code block的存在，需要分清楚每个变量的作用域。解决方法是对每一个scope都建立一个符号表。

2. Hash冲突问题：采用separate chaining的办法

符号表具体的设计如下：

| nest, tail | 符号表链表，指向内部scope对应的符号表 |
| ---------- | ------------------------------------- |
| name       | 符号表的名称，与对应的scope相一致     |
| bucket	| 存放符号entry的hash bucket |

语义分析需要实现符号表，根据设计，最终其他模块只需要全局的scope对应的符号表指针即可，因为内部scope的符号表可以通过符号表内的链表最终找到。

由于C Minus语言的scope是静态的，所以name的命名其实并不必要，因为符号表是静态的，跟后续代码生成的分析的顺序是一致的，遍历语法树的时候就可以知道当前scope该用哪一张符号表。所以name可以先不管。

运行环境和代码生成模块需要的接口就是一个lookup，能够针对给定的符号表和变量名，得到对应的entry（如果没有则返回null）。

## Type Checking

语义分析的第二个任务就是类型检查，这一部分我没有做专门的设计，在语义分析阶段能够完成并且能够检查出错误即可，后续模块暂不需求type checking

## Tips

有关语义分析的代码实现完全可以参考教材给的编译器的代码实现，感觉应该就是照着它的逻辑写，只不过我们的语言多了scope需要注意。

就还剩最后几天了，我计划着咱们到5月31号之前要把code全部搞完，这样1号2号才能有时间写一份比较好的报告，兄弟们加油啊。

Semantic Analysis部分就辛苦你们了！我会把后端在周三上课之前搞定，到上课的时候我们再讨论一下这些问题。